#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import dp kivy.metrics.dp

#:kivy 2.1.0

<BaseScreen>:
    MDLabel:
        text: root.name
        halign: 'center'

<MenuCard>:
    name: ""
    image_path: ""
    price: 0
    actual_image_source: ""

    orientation: "vertical"
    spacing: dp(0) 
    padding: dp(0) 
    size_hint_y: None
    height: self.minimum_height
    elevation: 2 
    radius: [dp(15), dp(15), dp(15), dp(15)] 

    FitImage:
        source: root.actual_image_source
        size_hint_y: None
        height: dp(100)
        radius: [dp(15), dp(15), dp(0), dp(0)] 
        allow_stretch: False
        keep_ratio: True
        mipmap: True

    MDBoxLayout:
        orientation: 'vertical'
        size_hint_y: None 
        height: self.minimum_height 
        padding: [dp(10), dp(4), dp(10), dp(10)] 
        spacing: dp(4) 

        MDLabel:
            text: root.name
            halign: "center" 
            theme_text_color: "Primary"
            font_style: "Subtitle1" 
            bold: True
            adaptive_height: True

        MDLabel:
            text: f"Rp {root.price:,.0f}".replace(",", ".")
            halign: "center" 
            theme_text_color: "Secondary"
            font_style: "Body1" 
            adaptive_height: True

<AddMenu>:
    name: 'Add Menu'
    MDBoxLayout:
        orientation: 'vertical'

        MDBoxLayout:
            orientation: 'horizontal'
            adaptive_height: True
            padding: [dp(12), dp(10), dp(12), dp(10)]
            spacing: dp(10)
            MDTextField:
                id: search_field
                hint_text: "Search Item"
                mode: "rectangle"
                radius: [dp(8), dp(8), dp(8), dp(8)]
                on_text: root.search_items(self.text)
                size_hint_y: None
                height: dp(48)
                text_color_normal: 0, 0, 0, 1
                hint_text_color_normal: .5, .5, .5, 1
                size_hint_x: 1
                icon_left: "magnify"

            MDIconButton:
                icon: "plus-circle-outline"
                on_release: root.open_add_item_dialog()
                pos_hint: {"center_y": .5}
                user_font_size: "30sp"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color

        ScrollView:
            GridLayout:
                id: search_result_list
                cols: 2
                size_hint_y: None
                height: self.minimum_height
                padding: dp(10)
                spacing: dp(10)


MDBoxLayout:
    orientation: 'vertical'
    md_bg_color: app.theme_cls.bg_light

    MDScreenManager:
        id: screen_manager
        transition: NoTransition()

        BaseScreen:
            name: 'Cart'

        AddMenu:

        BaseScreen:
            name: 'History'

        BaseScreen:
            name: 'Settings'

    BoxLayout:
        size_hint_y: None
        height: "60dp"
        padding: [dp(20), dp(5), dp(20), dp(10)] 

        MDCard:
            md_bg_color: app.theme_cls.primary_color 
            radius: [30, 30, 30, 30]
            elevation: 4
            padding: 0
            
            BoxLayout:
                orientation: 'horizontal'
                padding: [dp(5), 0, dp(5), 0] 
                spacing: dp(8)

                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 1
                    spacing: dp(2) 
                    MDCard: 
                        size_hint_y: None
                        height: "2dp"
                        size_hint_x: None
                        width: dp(24)
                        md_bg_color: 1, 1, 1, 1 
                        opacity: 1 if app.current_active == 'Cart' else 0
                        radius: [dp(1.5)]
                        pos_hint: {'center_x': 0.5}
                        elevation: 0
                    MDIconButton:
                        icon: "cart" if app.current_active == 'Cart' else "cart-outline"
                        theme_icon_color: "Custom"
                        icon_color: 1, 1, 1, 1
                        icon_size: "26dp" if app.current_active == 'Cart' else "24dp"
                        ripple_scale: 0
                        on_release: app.switch_screen('Cart')
                        md_bg_color: 0, 0, 0, 0
                        pos_hint: {'center_x': 0.5}

                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 1
                    spacing: dp(2)
                    MDCard: 
                        size_hint_y: None
                        height: "2dp" 
                        size_hint_x: None
                        width: dp(24)
                        md_bg_color: 1, 1, 1, 1 
                        opacity: 1 if app.current_active == 'Add Menu' else 0
                        radius: [dp(1)] 
                        pos_hint: {'center_x': 0.5}
                        elevation: 0
                    MDIconButton:
                        icon: "plus-box" if app.current_active == 'Add Menu' else "plus-box-outline"
                        theme_icon_color: "Custom"
                        icon_color: 1, 1, 1, 1
                        icon_size: "26dp" if app.current_active == 'Add Menu' else "24dp"
                        ripple_scale: 0
                        on_release: app.switch_screen('Add Menu')
                        md_bg_color: 0, 0, 0, 0
                        pos_hint: {'center_x': 0.5}

                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 1
                    spacing: dp(2)
                    MDCard: 
                        size_hint_y: None
                        height: "2dp"
                        size_hint_x: None
                        width: dp(24)
                        md_bg_color: 1, 1, 1, 1
                        opacity: 1 if app.current_active == 'History' else 0
                        radius: [dp(1)]
                        pos_hint: {'center_x': 0.5}
                        elevation: 0
                    MDIconButton:
                        icon: "clock" if app.current_active == 'History' else "clock-outline"
                        theme_icon_color: "Custom"
                        icon_color: 1, 1, 1, 1
                        icon_size: "26dp" if app.current_active == 'History' else "24dp"
                        ripple_scale: 0
                        on_release: app.switch_screen('History')
                        md_bg_color: 0, 0, 0, 0
                        pos_hint: {'center_x': 0.5}

                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 1
                    spacing: dp(2)
                    MDCard: 
                        size_hint_y: None
                        height: "2dp"
                        size_hint_x: None
                        width: dp(24)
                        md_bg_color: 1, 1, 1, 1 
                        opacity: 1 if app.current_active == 'Settings' else 0
                        radius: [dp(1.5)]
                        pos_hint: {'center_x': 0.5}
                        elevation: 0
                    MDIconButton:
                        icon: "cog" if app.current_active == 'Settings' else "cog-outline"
                        theme_icon_color: "Custom"
                        icon_color: 1, 1, 1, 1
                        icon_size: "26dp" if app.current_active == 'Settings' else "24dp"
                        ripple_scale: 0
                        on_release: app.switch_screen('Settings')
                        md_bg_color: 0, 0, 0, 0
                        pos_hint: {'center_x': 0.5}